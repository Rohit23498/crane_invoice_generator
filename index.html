<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>PDF Maker - Crane Selection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .form-container {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        input, select, textarea {
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #d32f2f;
            background: white;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(211, 47, 47, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.4);
        }

        .dynamic-row {
            display: grid;
            grid-template-columns: 2fr 1.5fr 0.8fr 1fr 1fr 0.8fr auto;
            gap: 10px;
            margin-bottom: 15px;
            align-items: end;
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .dynamic-row select,
        .dynamic-row input {
            margin-bottom: 0;
            min-width: 0;
        }

        .dynamic-row .btn-danger {
            padding: 12px 16px;
            white-space: nowrap;
        }

        .dynamic-row input[type="number"] {
            text-align: center;
        }

        #tableRows {
            margin-bottom: 20px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        #pdf-preview {
            display: block;
            padding: 30px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin: 30px auto;
            max-width: 800px;
        }

        #pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        #pdf-table th {
            background: linear-gradient(135deg, #d32f2f, #b71c1c);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        #pdf-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        #pdf-table tr:hover {
            background: #f8fafc;
        }

        .crane-images-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .crane-image-item {
            text-align: center;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .crane-image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .crane-image-item .label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #4a5568;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .dynamic-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .dynamic-row > div {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }
            
            .dynamic-row > div:last-child {
                flex-direction: row;
                justify-content: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 1024px) {
            .dynamic-row {
                grid-template-columns: 1.5fr 1fr 0.6fr 0.8fr 0.8fr 0.6fr auto;
                gap: 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>EKTA CRANE</h1>
            <p>Professional Quotation </p>
        </div>
        
        <div class="form-container">
            <!-- Quotation Details Section -->
            <div class="section">
                <h2 class="section-title">📋 Quotation Details</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Quotation Reference Number</label>
                        <input type="text" id="quotationRef" placeholder="e.g., ECMPL/306/25-26" value="ECMPL/306/25-26">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="quotationDate">
                    </div>
                    <div class="form-group">
                        <label>Time</label>
                        <input type="time" id="quotationTime">
                    </div>
                </div>
            </div>

            <!-- Client Information Section -->
            <div class="section">
                <h2 class="section-title">👤 Client Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="clientCompanyInput" placeholder="Enter Company Name">
                    </div>
                    <div class="form-group">
                        <label>GST Number</label>
                        <input type="text" id="clientGSTInput" placeholder="Enter GST Number">
                    </div>
                    <div class="form-group">
                        <label>Contact Number</label>
                        <input type="text" id="clientContactInput" placeholder="Enter Contact Number">
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" id="clientEmailInput" placeholder="Enter Email Address">
                    </div>
                    <div class="form-group">
                        <label>Kind Attention (Contact Person)</label>
                        <input type="text" id="clientAttentionInput" placeholder="Enter Contact Person Name">
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="clientAddressInput" placeholder="Enter Complete Address" rows="3"></textarea>
                </div>
            </div>

            <!-- Crane Selection Section -->
            <div class="section">
                <h2 class="section-title">🏗️ Crane Selection</h2>
                
                <!-- Column Headers -->
                <div class="dynamic-row" style="background: #e2e8f0; font-weight: 600; color: #4a5568; margin-bottom: 10px;">
                    <div style="display: flex; align-items: center;">Crane Type</div>
                    <div style="display: flex; align-items: center;">Capacity</div>
                    <div style="display: flex; align-items: center;">Custom</div>
                    <div style="display: flex; align-items: center;">Qty</div>
                    <div style="display: flex; align-items: center;">Rate (₹)</div>
                    <div style="display: flex; align-items: center;">Amount (₹)</div>
                    <div style="display: flex; align-items: center;">Action</div>
                </div>
                
    <div id="tableRows"></div>
                <div class="action-buttons">
                    <button type="button" onclick="addRow()" class="btn btn-secondary">
                        ➕ Add Row
                    </button>
                    <button onclick="generatePDF()" class="btn btn-primary">
                        📄 Generate PDF
                    </button>
                </div>
            </div>
        </div>

    <!-- PDF Preview Div -->
    <div id="pdf-preview">
        <!-- EKTA CRANE Header -->
        <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #d32f2f; padding-bottom: 15px;">
            <!-- Company Logo and Name -->
            <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                <div style="width: 80px; height: 80px; margin-right: 20px; position: relative;">
                    <svg width="80" height="80" viewBox="0 0 80 80" style="position: absolute; top: 0; left: 0;">
                        <!-- Outer gear-like circle -->
                        <circle cx="40" cy="40" r="38" fill="#d32f2f" stroke="#d32f2f" stroke-width="2"/>
                        <!-- Gear teeth pattern -->
                        <g fill="#d32f2f">
                            <rect x="38" y="2" width="4" height="8" rx="2"/>
                            <rect x="70" y="38" width="8" height="4" ry="2"/>
                            <rect x="38" y="70" width="4" height="8" rx="2"/>
                            <rect x="2" y="38" width="8" height="4" ry="2"/>
                            <rect x="65" y="15" width="6" height="4" rx="2" transform="rotate(45 68 17)"/>
                            <rect x="65" y="61" width="6" height="4" rx="2" transform="rotate(-45 68 63)"/>
                            <rect x="9" y="15" width="6" height="4" rx="2" transform="rotate(-45 12 17)"/>
                            <rect x="9" y="61" width="6" height="4" rx="2" transform="rotate(45 12 63)"/>
                        </g>
                        <!-- Inner C with crane hook -->
                        <g fill="white">
                            <!-- Left half of C -->
                            <path d="M25 20 Q20 20 20 25 L20 35 Q20 40 25 40 L30 40 L30 25 Q30 20 25 20 Z"/>
                            <!-- Right half of C -->
                            <path d="M55 20 Q60 20 60 25 L60 35 Q60 40 55 40 L50 40 L50 25 Q50 20 55 20 Z"/>
                            <!-- Crane hook -->
                            <path d="M35 45 L35 55 Q35 60 40 60 L45 60 Q50 60 50 55 L50 50 Q50 45 45 45 L40 45 Q35 45 35 50 Z"/>
                        </g>
                        <!-- Registered trademark symbol -->
                        <text x="65" y="25" fill="white" font-size="8" font-weight="bold" font-family="Arial">®</text>
                    </svg>
                </div>
                <div>
                    <div style="color: #d32f2f; font-size: 20px; font-weight: bold; letter-spacing: 1px;">EKTA CRANE</div>
                    <div style="font-size: 11px; color: #d32f2f; font-weight: 600; letter-spacing: 0.5px;">ISO 9001:2015</div>
                </div>
            </div>
            
            <h1 style="color: #d32f2f; font-size: 24px; margin: 5px 0; font-weight: bold;">EKTA CRANE MANUFACTURING PVT. LTD</h1>
            <p style="font-size: 12px; margin: 2px 0; color: #666;">CIN: U28162MH2025PTC443120</p>
            
            <!-- Services -->
            <p style="font-size: 14px; margin: 8px 0; font-weight: bold;">Design, Manufacturer, Installation & Maintenance of E.O.T. Cranes and Hoist</p>
            <p style="font-size: 12px; margin: 5px 0; color: #555;">E.O.T. Crane, Goods Lift, Wire rope Hoist, Chain Pully Block & All Types of Crane Repairing & Fabrication, Material Handling System</p>
            
            <!-- Addresses -->
            <div style="display: flex; justify-content: space-between; margin: 10px 0; font-size: 11px;">
                <div style="text-align: left; flex: 1;">
                    <strong>Unit No. I:</strong><br>
                    Gala No.2, Golani Naka, Asjad Commercial Complex,<br>
                    Vasai (E), Dist - Palghar, MH., India - 401 208.
                </div>
                <div style="text-align: right; flex: 1;">
                    <strong>Unit No. II:</strong><br>
                    Survey No. 89, H.No.1, Next of Udupi Hotel,<br>
                    N.H. 8, Vasai (E), Dist - Palghar, MH., 401 208.
                </div>
            </div>
            
            <!-- Contact Information -->
            <div style="font-size: 11px; margin: 8px 0;">
                <strong>Website:</strong> www.ektacrane.com | 
                <strong>Email:</strong> ektacrane@gmail.com & ektacrane@rediffmail.com | 
                <strong>Land Line:</strong> 8446081899 / 9324634828 / 9594111331
            </div>
        </div>
        
        <!-- Quotation Details -->
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #ccc; padding-bottom: 10px;">
            <div>
                <strong>Ref. No.</strong> <span id="pdf-quotationRef">ECMPL/306/25-26</span>
            </div>
            <div style="text-align: right;">
                <h3 style="margin: 0; color: #d32f2f;">Sales Quotation Template</h3>
                <p style="margin: 5px 0 0 0; font-size: 14px;">
                    <strong>Date:</strong> <span id="pdf-date"></span> | 
                    <strong>Time:</strong> <span id="pdf-time"></span>
                </p>
            </div>
        </div>
        
        <!-- Recipient Section -->
        <div style="margin-bottom: 20px;">
            <h4 style="color: #d32f2f; margin-bottom: 10px;">To:</h4>
            <div style="border: 1px solid #ddd; padding: 15px; background: #f9f9f9;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <div>
                        <strong>Company Name:</strong> <input type="text" id="clientCompany" placeholder="Enter Company Name" style="border: none; background: transparent; font-weight: bold; width: 300px;">
                    </div>
                    <div>
                        <strong>GST No:</strong> <input type="text" id="clientGST" placeholder="Enter GST Number" style="border: none; background: transparent; width: 150px;">
                    </div>
                </div>
                <div style="margin-bottom: 8px;">
                    <strong>Address:</strong> <input type="text" id="clientAddress" placeholder="Enter Complete Address" style="border: none; background: transparent; width: 100%;">
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <div>
                        <strong>Contact:</strong> <input type="text" id="clientContact" placeholder="Enter Contact Number" style="border: none; background: transparent; width: 150px;">
                    </div>
                    <div>
                        <strong>Email:</strong> <input type="text" id="clientEmail" placeholder="Enter Email Address" style="border: none; background: transparent; width: 200px;">
                    </div>
                </div>
                <div style="margin-top: 10px; text-align: center;">
                    <strong>Kind Attention:</strong> <input type="text" id="clientAttention" placeholder="Enter Contact Person Name" style="border: none; background: transparent; font-weight: bold; width: 200px;">
                </div>
            </div>
        </div>
        <table id="pdf-table">
            <thead>
                <tr>
                    <th>Crane Type</th>
                    <th>Capacity (Tonnes)</th>
                    <th>Qty</th>
                    <th>Rate (Rs.)</th>
                    <th>Amt (Rs.)</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr>
                    <td colspan="4" style="text-align:right; font-weight:bold;">Sub Total</td>
                    <td id="pdf-subtotal" style="font-weight:bold;"></td>
                </tr>
            </tfoot>
        </table>
        
        <!-- Crane Images Section -->
        <div id="crane-images-section" style="margin: 20px 0; text-align: center;">
            <h4>🏗️ Selected Crane Images</h4>
            <div id="crane-images-container" class="crane-images-container">
                <!-- Images will be dynamically added here -->
            </div>
        </div>
        
        <h4>Terms & Conditions</h4>
        <ul style="font-size:12px; line-height:1.5;">
            <li><b>WARRANTY:</b> 1 YEAR DOMESTIC WARRANTY, INCLUDING ONLY PARTS & LABOR DEFECTS BUT NOT THE DEFECTS DUE TO EXTERNAL CAUSES ACCIDENTAL OR PHYSICAL DAMAGES</li>
            <li><b>BANK DETAILS:</b> BANK OF INDIA A/C: 017820110000188 (IFSC: BKID0000178) BRANCH (VASAI WEST)</li>
            <li><b>GST NO:</b> 27AAICE7407Q1Z0 | <b>PAN No:</b> AAICE7407Q</li>
            <li><b>PAYMENTS:</b> 50% ADVANCE WITH PURCHASE ORDER & 40% BEFORE DISPATCH & 10% BALANCE AFTER TESTING</li>
            <li><b>DELIVERY PERIOD:</b> WITHIN 3-4 MONTH WORKING DAYS FROM THE DATE OF CONFIRMED PO ALONG WITH ADVANCE</li>
        </ul>
        <div style="text-align: center; margin-top: 30px; font-style: italic; color: #666;">
            <p><strong>This is computer generated Quotation does not require any signature and stamp.</strong></p>
        </div>
    </div>

    <script>
        // Crane images mapping
        const craneImages = {
            "Single Girder EOT Crane": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+10T",
                "15 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+15T",
                "20 Tonne": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+20T",
                "Others": "https://via.placeholder.com/200x150/4CAF50/white?text=Single+Girder+EOT+Custom"
            },
            "Double Girder EOT Crane": {
                "2 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+10T",
                "50 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+50T",
                "100 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+100T",
                "150 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+150T",
                "250 Tonne": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+250T",
                "Others": "https://via.placeholder.com/200x150/2196F3/white?text=Double+Girder+EOT+Custom"
            },
            "Underslung EOT Crane": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+10T",
                "Others": "https://via.placeholder.com/200x150/FF9800/white?text=Underslung+EOT+Custom"
            },
            "Single Girder Gantry Crane": {
                "1 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+10T",
                "15 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+15T",
                "20 Tonne": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+20T",
                "Others": "https://via.placeholder.com/200x150/9C27B0/white?text=Single+Girder+Gantry+Custom"
            },
            "Double Girder Gantry Crane": {
                "5 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+10T",
                "50 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+50T",
                "100 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+100T",
                "200 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+200T",
                "500 Tonne": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+500T",
                "Others": "https://via.placeholder.com/200x150/E91E63/white?text=Double+Girder+Gantry+Custom"
            },
            "Semi Gantry Crane": {
                "2 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+10T",
                "15 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+15T",
                "20 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+20T",
                "50 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+50T",
                "80 Tonne": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+80T",
                "Others": "https://via.placeholder.com/200x150/795548/white?text=Semi+Gantry+Custom"
            },
            "Wall Mounted Jib Crane": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+10T",
                "16 Tonne": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+16T",
                "Others": "https://via.placeholder.com/200x150/607D8B/white?text=Wall+Jib+Custom"
            },
            "Pillar Mounted Jib Crane": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+10T",
                "16 Tonne": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+16T",
                "Others": "https://via.placeholder.com/200x150/3F51B5/white?text=Pillar+Jib+Custom"
            },
            "Container Crane": {
                "20 Tonne": "https://via.placeholder.com/200x150/FF5722/white?text=Container+20T",
                "45 Tonne": "https://via.placeholder.com/200x150/FF5722/white?text=Container+45T",
                "Others": "https://via.placeholder.com/200x150/FF5722/white?text=Container+Custom"
            },
            "Small Gantry Crane": {
                "0.25 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+0.25T",
                "0.50 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+10T",
                "Others": "https://via.placeholder.com/200x150/8BC34A/white?text=Small+Gantry+Custom"
            },
            "Wire Rope Electric Hoist": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+10T",
                "20 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+20T",
                "36 Tonne": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+36T",
                "Others": "https://via.placeholder.com/200x150/00BCD4/white?text=Wire+Rope+Custom"
            },
            "Electric Chain Hoist": {
                "0.5 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+0.5T",
                "1 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+1T",
                "2 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+2T",
                "5 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+5T",
                "10 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+10T",
                "15 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+15T",
                "25 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+25T",
                "35 Tonne": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+35T",
                "Others": "https://via.placeholder.com/200x150/CDDC39/white?text=Chain+Hoist+Custom"
            }
        };

        // JSON data for cranes and capacities
        const cranesData = {
            "Single Girder EOT Crane": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "15 Tonne", "20 Tonne", "Others"],
            "Double Girder EOT Crane": ["2 Tonne", "5 Tonne", "10 Tonne", "50 Tonne", "100 Tonne", "150 Tonne", "250 Tonne", "Others"],
            "Underslung EOT Crane": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "Others"],
            "Single Girder Gantry Crane": ["1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "15 Tonne", "20 Tonne", "Others"],
            "Double Girder Gantry Crane": ["5 Tonne", "10 Tonne", "50 Tonne", "100 Tonne", "200 Tonne", "500 Tonne", "Others"],
            "Semi Gantry Crane": ["2 Tonne", "5 Tonne", "10 Tonne", "15 Tonne", "20 Tonne", "50 Tonne", "80 Tonne", "Others"],
            "Wall Mounted Jib Crane": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "16 Tonne", "Others"],
            "Pillar Mounted Jib Crane": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "16 Tonne", "Others"],
            "Container Crane": ["20 Tonne", "45 Tonne", "Others"],
            "Small Gantry Crane": ["0.25 Tonne", "0.50 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "Others"],
            "Wire Rope Electric Hoist": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "20 Tonne", "36 Tonne", "Others"],
            "Electric Chain Hoist": ["0.5 Tonne", "1 Tonne", "2 Tonne", "5 Tonne", "10 Tonne", "15 Tonne", "25 Tonne", "35 Tonne", "Others"]
        };

        function addRow(crane = '', capacity = '', qty = 0, rate = 0) {
            const div = document.createElement('div');
            div.classList.add('dynamic-row');

            // Crane dropdown
            const craneSelect = document.createElement('select');
            for (const craneType in cranesData) {
                const option = document.createElement('option');
                option.value = craneType;
                option.textContent = craneType;
                if (craneType === crane) option.selected = true;
                craneSelect.appendChild(option);
            }

            // Capacity dropdown
            const capacitySelect = document.createElement('select');
            function updateCapacityOptions(selectedCrane) {
                capacitySelect.innerHTML = '';
                cranesData[selectedCrane].forEach(cap => {
                    const opt = document.createElement('option');
                    opt.value = cap;
                    opt.textContent = cap;
                    if (cap == capacity) opt.selected = true;
                    capacitySelect.appendChild(opt);
                });
            }
            updateCapacityOptions(craneSelect.value);

            // Show input if 'Other' is selected
            const otherInput = document.createElement('input');
            otherInput.type = 'number';
            otherInput.placeholder = 'Enter capacity';
            otherInput.style.display = capacitySelect.value === 'Other' ? 'block' : 'none';
            if (capacitySelect.value !== 'Other') otherInput.value = '';

            capacitySelect.addEventListener('change', () => {
                if (capacitySelect.value === 'Other') {
                    otherInput.style.display = 'block';
                } else {
                    otherInput.style.display = 'none';
                    otherInput.value = '';
                }
            });

            craneSelect.addEventListener('change', () => {
                updateCapacityOptions(craneSelect.value);
                if (capacitySelect.value === 'Other') otherInput.style.display = 'block';
                else otherInput.style.display = 'none';
                updateCraneImages(); // Update images when crane changes
            });

            capacitySelect.addEventListener('change', () => {
                if (capacitySelect.value === 'Other') {
                    otherInput.style.display = 'block';
                } else {
                    otherInput.style.display = 'none';
                    otherInput.value = '';
                }
                updateCraneImages(); // Update images when capacity changes
            });

            otherInput.addEventListener('input', () => {
                updateCraneImages(); // Update images when custom capacity is entered
            });

            // Quantity, Rate, Amount
            const qtyInput = document.createElement('input');
            qtyInput.type = 'number'; qtyInput.value = qty; qtyInput.placeholder = 'Qty';
            qtyInput.min = 0; qtyInput.oninput = () => calculateAmt(div);

            const rateInput = document.createElement('input');
            rateInput.type = 'number'; rateInput.value = rate; rateInput.placeholder = 'Rate';
            rateInput.min = 0; rateInput.oninput = () => calculateAmt(div);

            const amtInput = document.createElement('input');
            amtInput.type = 'number'; amtInput.placeholder = 'Amt'; amtInput.value = 0; amtInput.readOnly = true;

            const removeBtn = document.createElement('button');
            removeBtn.type = 'button'; 
            removeBtn.textContent = '🗑️ Remove';
            removeBtn.className = 'btn btn-danger';
            removeBtn.onclick = () => {
                div.remove();
                updateCraneImages(); // Update images when row is removed
            };

            div.appendChild(craneSelect);
            div.appendChild(capacitySelect);
            div.appendChild(otherInput);
            div.appendChild(qtyInput);
            div.appendChild(rateInput);
            div.appendChild(amtInput);
            div.appendChild(removeBtn);

            document.getElementById('tableRows').appendChild(div);
        }

        function calculateAmt(row) {
            const qty = parseFloat(row.children[3].value) || 0;
            const rate = parseFloat(row.children[4].value) || 0;
            row.children[5].value = qty * rate;
        }

        function updateCraneImages() {
            const container = document.getElementById('crane-images-container');
            container.innerHTML = '';
            
            // Get unique crane selections
            const selectedCranes = new Set();
            document.querySelectorAll('#tableRows .dynamic-row').forEach(row => {
                const crane = row.children[0].value;
                let capacity = row.children[1].value;
                if (capacity === 'Other') capacity = row.children[2].value || 'Others';
                selectedCranes.add(JSON.stringify({crane, capacity}));
            });

            selectedCranes.forEach(craneData => {
                const {crane, capacity} = JSON.parse(craneData);
                const imageUrl = craneImages[crane] && craneImages[crane][capacity] 
                    ? craneImages[crane][capacity] 
                    : 'https://via.placeholder.com/200x150/CCCCCC/white?text=No+Image';
                
                const imageDiv = document.createElement('div');
                imageDiv.className = 'crane-image-item';
                
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = `${crane} - ${capacity}`;
                
                const label = document.createElement('div');
                label.className = 'label';
                label.textContent = `${crane} - ${capacity}`;
                
                imageDiv.appendChild(img);
                imageDiv.appendChild(label);
                container.appendChild(imageDiv);
            });
        }

        function generatePDF() {
            const pdfPreview = document.getElementById('pdf-preview');
            const pdfTableBody = document.querySelector('#pdf-table tbody');
            const pdfSubtotal = document.getElementById('pdf-subtotal');
            const pdfDate = document.getElementById('pdf-date');
            const pdfTime = document.getElementById('pdf-time');
            const pdfQuotationRef = document.getElementById('pdf-quotationRef');

            // Set current date and time if not provided
            const quotationDate = document.getElementById('quotationDate').value || new Date().toISOString().split('T')[0];
            const quotationTime = document.getElementById('quotationTime').value || new Date().toTimeString().split(' ')[0].substring(0, 5);
            const quotationRef = document.getElementById('quotationRef').value || 'ECMPL/306/25-26';
            
            pdfDate.textContent = quotationDate;
            pdfTime.textContent = quotationTime;
            pdfQuotationRef.textContent = quotationRef;

            // Update client information
            document.getElementById('clientCompany').value = document.getElementById('clientCompanyInput').value || '';
            document.getElementById('clientGST').value = document.getElementById('clientGSTInput').value || '';
            document.getElementById('clientAddress').value = document.getElementById('clientAddressInput').value || '';
            document.getElementById('clientContact').value = document.getElementById('clientContactInput').value || '';
            document.getElementById('clientEmail').value = document.getElementById('clientEmailInput').value || '';
            document.getElementById('clientAttention').value = document.getElementById('clientAttentionInput').value || '';

            // Update crane images
            updateCraneImages();

            pdfTableBody.innerHTML = '';
            let subtotal = 0;

            document.querySelectorAll('#tableRows .dynamic-row').forEach(row => {
                const crane = row.children[0].value;
                let capacity = row.children[1].value;
                if (capacity === 'Other') capacity = row.children[2].value || 'N/A';
                const qty = row.children[3].value;
                const rate = row.children[4].value;
                const amt = row.children[5].value;

                subtotal += parseFloat(amt) || 0;

                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${crane}</td><td>${capacity}</td><td>${qty}</td><td>${rate}</td><td>${amt}</td>`;
                pdfTableBody.appendChild(tr);
            });

            pdfSubtotal.textContent = subtotal.toLocaleString("en-IN");

            // Generate PDF with multiple pages
            generateMultiPagePDF();
        }

        function generateMultiPagePDF() {
            const pdf = new window.jspdf.jsPDF('p', 'pt', 'a4');
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const margin = 40;
            const contentWidth = pageWidth - (2 * margin);
            let currentY = margin;
            let pageCount = 1;
            
            // Helper function to add new page only when needed
            function addNewPage() {
                // Only add new page if current page has content
                if (currentY > margin + 50) { // 50pt minimum content threshold
                    pdf.addPage();
                    currentY = margin;
                    pageCount++;
                }
            }
            
            // Helper function to check if content fits on current page
            function checkPageSpace(requiredHeight) {
                return (currentY + requiredHeight) < (pageHeight - margin);
            }
            
            // Helper function to ensure we don't create empty pages
            function ensureContentBeforeNewPage(requiredHeight) {
                if (!checkPageSpace(requiredHeight)) {
                    // Only add new page if current page has meaningful content
                    if (currentY > margin + 50) {
                        addNewPage();
                        return true;
                    }
                }
                return false;
            }
            
            // Helper function to add text with word wrapping
            function addWrappedText(text, fontSize = 12, isBold = false, color = '#000000') {
                pdf.setFontSize(fontSize);
                pdf.setFont('helvetica', isBold ? 'bold' : 'normal');
                pdf.setTextColor(color);
                
                const lines = pdf.splitTextToSize(text, contentWidth);
                const lineHeight = fontSize * 1.2;
                
                if (!checkPageSpace(lines.length * lineHeight)) {
                    ensureContentBeforeNewPage(lines.length * lineHeight);
                }
                
                lines.forEach(line => {
                    if (!checkPageSpace(lineHeight)) {
                        ensureContentBeforeNewPage(lineHeight);
                    }
                    pdf.text(line, margin, currentY);
                    currentY += lineHeight;
                });
            }
            
            // Helper function to add image
            function addImage(imgData, width, height, description = '') {
                const imgHeight = (height * contentWidth) / width;
                
                if (!checkPageSpace(imgHeight + 20)) {
                    ensureContentBeforeNewPage(imgHeight + 20);
                }
                
                pdf.addImage(imgData, 'JPEG', margin, currentY, contentWidth, imgHeight);
                currentY += imgHeight + 10;
                
                if (description) {
                    addWrappedText(description, 10, false, '#666666');
                }
            }
            
            // Page 1: Header and Company Information (matching UI exactly)
            
            // EKTA CRANE Logo and Header (matching UI design)
            addWrappedText('EKTA CRANE MANUFACTURING PVT. LTD', 20, true, '#d32f2f');
            currentY += 5;
            addWrappedText('CIN: U28162MH2025PTC443120', 10, false, '#666666');
            currentY += 10;
            
            // Services (matching UI)
            addWrappedText('Design, Manufacturer, Installation & Maintenance of E.O.T. Cranes and Hoist', 12, true);
            addWrappedText('E.O.T. Crane, Goods Lift, Wire rope Hoist, Chain Pully Block & All Types of Crane Repairing & Fabrication, Material Handling System', 10, false, '#555555');
            currentY += 15;
            
            // Company addresses (matching UI layout)
            addWrappedText('Unit No. I: Gala No.2, Golani Naka, Asjad Commercial Complex, Vasai (E), Dist - Palghar, MH., India - 401 208.', 9);
            addWrappedText('Unit No. II: Survey No. 89, H.No.1, Next of Udupi Hotel, N.H. 8, Vasai (E), Dist - Palghar, MH., 401 208.', 9);
            addWrappedText('Website: www.ektacrane.com | Email: ektacrane@gmail.com & ektacrane@rediffmail.com | Land Line: 8446081899 / 9324634828 / 9594111331', 9);
            currentY += 20;
            
            // Quotation details (matching UI layout)
            const quotationRef = document.getElementById('quotationRef').value || 'ECMPL/306/25-26';
            const quotationDate = document.getElementById('quotationDate').value || new Date().toISOString().split('T')[0];
            const quotationTime = document.getElementById('quotationTime').value || new Date().toTimeString().split(' ')[0].substring(0, 5);
            
            // Draw a line separator like in UI
            pdf.setDrawColor(211, 47, 47);
            pdf.setLineWidth(2);
            pdf.line(margin, currentY, pageWidth - margin, currentY);
            currentY += 15;
            
            addWrappedText(`Ref. No. ${quotationRef}`, 12, true);
            addWrappedText(`Sales Quotation Template`, 14, true, '#d32f2f');
            addWrappedText(`Date: ${quotationDate} | Time: ${quotationTime}`, 12, true);
            currentY += 20;
            
            // Client information (matching UI box design)
            addWrappedText('To:', 12, true, '#d32f2f');
            currentY += 10;
            
            // Draw client info box (matching UI)
            pdf.setFillColor(249, 249, 249);
            pdf.setDrawColor(221, 221, 221);
            pdf.setLineWidth(1);
            pdf.rect(margin, currentY, contentWidth, 80, 'FD');
            currentY += 10;
            
            const clientCompany = document.getElementById('clientCompanyInput').value || '';
            const clientGST = document.getElementById('clientGSTInput').value || '';
            const clientAddress = document.getElementById('clientAddressInput').value || '';
            const clientContact = document.getElementById('clientContactInput').value || '';
            const clientEmail = document.getElementById('clientEmailInput').value || '';
            const clientAttention = document.getElementById('clientAttentionInput').value || '';
            
            if (clientCompany) addWrappedText(`Company Name: ${clientCompany}`, 10, true);
            if (clientGST) addWrappedText(`GST No: ${clientGST}`, 10);
            if (clientAddress) addWrappedText(`Address: ${clientAddress}`, 10);
            if (clientContact) addWrappedText(`Contact: ${clientContact}`, 10);
            if (clientEmail) addWrappedText(`Email: ${clientEmail}`, 10);
            if (clientAttention) addWrappedText(`Kind Attention: ${clientAttention}`, 10, true);
            
            currentY += 90;
            
            // Check if we need a new page for the table
            if (!checkPageSpace(100)) {
                ensureContentBeforeNewPage(100);
            }
            
            // Crane selection table (matching UI exactly)
            addWrappedText('CRANE SELECTION', 14, true, '#d32f2f');
            currentY += 10;
            
            // Table headers (matching UI table)
            const tableHeaders = ['Crane Type', 'Capacity (Tonnes)', 'Qty', 'Rate (Rs.)', 'Amt (Rs.)'];
            const colWidths = [contentWidth * 0.35, contentWidth * 0.2, contentWidth * 0.1, contentWidth * 0.15, contentWidth * 0.2];
            
            // Draw table headers (matching UI red header)
            pdf.setFillColor(211, 47, 47);
            pdf.rect(margin, currentY, contentWidth, 25, 'F');
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            
            let xPos = margin;
            tableHeaders.forEach((header, index) => {
                pdf.text(header, xPos + 5, currentY + 15);
                xPos += colWidths[index];
            });
            
            currentY += 25;
            pdf.setTextColor(0, 0, 0);
            
            // Table data
            let subtotal = 0;
            document.querySelectorAll('#tableRows .dynamic-row').forEach(row => {
                if (!checkPageSpace(20)) {
                    ensureContentBeforeNewPage(20);
                    // Redraw headers on new page
                    pdf.setFillColor(211, 47, 47);
                    pdf.rect(margin, currentY, contentWidth, 25, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    xPos = margin;
                    tableHeaders.forEach((header, index) => {
                        pdf.text(header, xPos + 5, currentY + 15);
                        xPos += colWidths[index];
                    });
                    currentY += 25;
                    pdf.setTextColor(0, 0, 0);
                }
                
                const crane = row.children[0].value;
                let capacity = row.children[1].value;
                if (capacity === 'Other') capacity = row.children[2].value || 'N/A';
                const qty = row.children[3].value;
                const rate = row.children[4].value;
                const amt = row.children[5].value;
                
                subtotal += parseFloat(amt) || 0;
                
                // Draw table row
                pdf.setFontSize(9);
                pdf.setFont('helvetica', 'normal');
                xPos = margin;
                
                // Crane Type
                const craneLines = pdf.splitTextToSize(crane, colWidths[0] - 10);
                pdf.text(craneLines[0], xPos + 5, currentY + 12);
                xPos += colWidths[0];
                
                // Capacity
                pdf.text(capacity, xPos + 5, currentY + 12);
                xPos += colWidths[1];
                
                // Qty
                pdf.text(qty, xPos + 5, currentY + 12);
                xPos += colWidths[2];
                
                // Rate
                pdf.text(rate, xPos + 5, currentY + 12);
                xPos += colWidths[3];
                
                // Amount
                pdf.text(amt, xPos + 5, currentY + 12);
                
                currentY += 20;
            });
            
            // Subtotal row (matching UI table footer)
            if (!checkPageSpace(30)) {
                ensureContentBeforeNewPage(30);
            }
            
            // Draw subtotal row (matching UI table footer)
            pdf.setFillColor(248, 249, 250);
            pdf.rect(margin, currentY, contentWidth, 25, 'F');
            pdf.setDrawColor(0, 0, 0);
            pdf.setLineWidth(1);
            pdf.rect(margin, currentY, contentWidth, 25, 'S');
            
            currentY += 5;
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'bold');
            pdf.text('Sub Total', margin + 5, currentY + 15);
            pdf.text(`₹${subtotal.toLocaleString("en-IN")}`, pageWidth - margin - 50, currentY + 15);
            currentY += 30;
            
            // Crane Images Section
            const craneImagesContainer = document.getElementById('crane-images-container');
            const craneImages = craneImagesContainer.querySelectorAll('.crane-image-item');
            
            if (craneImages.length > 0) {
                if (!checkPageSpace(100)) {
                    ensureContentBeforeNewPage(100);
                }
                
                addWrappedText('Selected Crane Images', 14, true, '#d32f2f');
                currentY += 20;
                
                // Generate images for each crane
                let imagePromises = [];
                craneImages.forEach((imageItem, index) => {
                    const img = imageItem.querySelector('img');
                    const label = imageItem.querySelector('.label');
                    
                    if (img && img.src) {
                        imagePromises.push(
                            new Promise((resolve) => {
                                const tempImg = new Image();
                                tempImg.crossOrigin = 'anonymous';
                                tempImg.onload = () => {
                                    const canvas = document.createElement('canvas');
                                    const ctx = canvas.getContext('2d');
                                    canvas.width = 200;
                                    canvas.height = 150;
                                    ctx.drawImage(tempImg, 0, 0, 200, 150);
                                    const imgData = canvas.toDataURL('image/jpeg');
                                    resolve({
                                        imgData: imgData,
                                        label: label ? label.textContent : '',
                                        index: index
                                    });
                                };
                                tempImg.onerror = () => resolve(null);
                                tempImg.src = img.src;
                            })
                        );
                    }
                });
                
                Promise.all(imagePromises).then((imageDataArray) => {
                    imageDataArray.forEach((imageData) => {
                        if (imageData) {
                            if (!checkPageSpace(200)) {
                                ensureContentBeforeNewPage(200);
                            }
                            
                            addImage(imageData.imgData, 200, 150, imageData.label);
                        }
                    });
                    
                    // Add terms and conditions on the last page
                    addTermsAndConditions();
                });
            } else {
                // Add terms and conditions if no images
                addTermsAndConditions();
            }
            
            function addTermsAndConditions() {
                if (!checkPageSpace(200)) {
                    ensureContentBeforeNewPage(200);
                }
                
                addWrappedText('Terms & Conditions', 14, true, '#d32f2f');
                currentY += 15;
                
                const terms = [
                    'WARRANTY: 1 YEAR DOMESTIC WARRANTY, INCLUDING ONLY PARTS & LABOR DEFECTS BUT NOT THE DEFECTS DUE TO EXTERNAL CAUSES ACCIDENTAL OR PHYSICAL DAMAGES',
                    'BANK DETAILS: BANK OF INDIA A/C: 017820110000188 (IFSC: BKID0000178) BRANCH (VASAI WEST)',
                    'GST NO: 27AAICE7407Q1Z0 | PAN No: AAICE7407Q',
                    'PAYMENTS: 50% ADVANCE WITH PURCHASE ORDER & 40% BEFORE DISPATCH & 10% BALANCE AFTER TESTING',
                    'DELIVERY PERIOD: WITHIN 3-4 MONTH WORKING DAYS FROM THE DATE OF CONFIRMED PO ALONG WITH ADVANCE'
                ];
                
                // Draw terms list (matching UI bullet points)
                terms.forEach(term => {
                    if (!checkPageSpace(30)) {
                        ensureContentBeforeNewPage(30);
                    }
                    addWrappedText(`• ${term}`, 10);
                    currentY += 5;
                });
                
                currentY += 20;
                
                // Add the disclaimer (matching UI center alignment)
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'bold');
                pdf.setTextColor(102, 102, 102);
                const disclaimerText = 'This is computer generated Quotation does not require any signature and stamp.';
                const textWidth = pdf.getTextWidth(disclaimerText);
                const centerX = (pageWidth - textWidth) / 2;
                pdf.text(disclaimerText, centerX, currentY);
                
                // Save the PDF
                pdf.save('ekta-crane-quotation.pdf');
            }
        }

        // Initialize with default values
        document.getElementById('quotationDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('quotationTime').value = new Date().toTimeString().split(' ')[0].substring(0, 5);
        
        addRow(); // initialize with one row
    </script>

</body>

</html>
